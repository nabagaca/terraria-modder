<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="TerrariaModManager.Views.SettingsView">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel MaxWidth="800" HorizontalAlignment="Left" Margin="24,24,24,36">
            <TextBlock Text="Settings" Classes="section-header"/>

            <!-- Terraria Path -->
            <Border Classes="card" Margin="0,0,0,12">
                <StackPanel>
                    <TextBlock Text="TERRARIA INSTALL PATH" Classes="label" FontWeight="SemiBold"/>
                    <Grid ColumnDefinitions="*,Auto,Auto">
                        <TextBox Grid.Column="0" Text="{Binding TerrariaPath}"
                                 Classes="dark"/>
                        <Button Grid.Column="1" Content="Browse" Classes="secondary"
                                Command="{Binding BrowsePathCommand}" Margin="8,0,0,0"/>
                        <Button Grid.Column="2" Content="Auto-detect" Classes="primary"
                                Command="{Binding AutoDetectCommand}" Margin="8,0,0,0"/>
                    </Grid>
                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                        <TextBlock Text="Core: " Foreground="{StaticResource TextSecondaryBrush}"/>
                        <TextBlock Text="{Binding CoreStatusText}" Foreground="{Binding CoreStatusColor}"/>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Nexus Account -->
            <Border Classes="card" Margin="0,0,0,12">
                <StackPanel>
                    <TextBlock Text="NEXUS MODS ACCOUNT" Classes="label" FontWeight="SemiBold"/>

                    <!-- Logged in state -->
                    <StackPanel IsVisible="{Binding IsLoggedIn}">
                        <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                            <TextBlock Text="Logged in as " Foreground="{StaticResource TextSecondaryBrush}"/>
                            <TextBlock Text="{Binding UserName}" FontWeight="SemiBold"/>
                            <Border Background="{StaticResource AccentSubtleBrush}" CornerRadius="3"
                                    Padding="6,2" Margin="8,0,0,0" VerticalAlignment="Center"
                                    IsVisible="{Binding IsPremium}">
                                <TextBlock Text="Premium" FontSize="10" Foreground="{StaticResource AccentBrush}"/>
                            </Border>
                        </StackPanel>
                        <Button Content="Logout" Classes="secondary"
                                Command="{Binding LogoutCommand}" Margin="0,8,0,0"
                                HorizontalAlignment="Left"/>
                    </StackPanel>

                    <!-- Not logged in state -->
                    <StackPanel IsVisible="{Binding !IsLoggedIn}">
                        <!-- SSO login (primary) -->
                        <Button Content="Login with Nexus Mods" Classes="primary"
                                Command="{Binding LoginWithNexusCommand}" Margin="0,4,0,0"
                                HorizontalAlignment="Left"
                                IsEnabled="{Binding !IsLoggingIn}"/>
                        <TextBlock Text="{Binding LoginStatus}" Foreground="{StaticResource TextSecondaryBrush}"
                                   FontSize="12" Margin="0,6,0,0" TextWrapping="Wrap"/>

                        <!-- Manual API key (fallback) -->
                        <TextBlock Text="Or enter your API key manually:" Foreground="{StaticResource TextSecondaryBrush}"
                                   FontSize="12" Margin="0,12,0,6"/>
                        <Grid ColumnDefinitions="*,Auto">
                            <TextBox Grid.Column="0" Text="{Binding ApiKey}"
                                     Classes="dark" PasswordChar="â€¢"/>
                            <Button Grid.Column="1" Content="Save" Classes="primary"
                                    Command="{Binding SaveManualKeyCommand}" Margin="8,0,0,0"/>
                        </Grid>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- NXM Handler -->
            <Border Classes="card" Margin="0,0,0,12">
                <StackPanel>
                    <TextBlock Text="DOWNLOAD WITH MANAGER" Classes="label" FontWeight="SemiBold"/>
                    <TextBlock Text="Enables the 'Download with Manager' button on Nexus Mods website"
                               Foreground="{StaticResource TextSecondaryBrush}" FontSize="12" Margin="0,0,0,8"/>
                    <StackPanel Orientation="Horizontal">
                        <Button Content="{Binding NxmButtonText}" Classes="primary"
                                Command="{Binding RegisterNxmCommand}"/>
                        <Button Content="Unregister" Classes="secondary"
                                Command="{Binding UnregisterNxmCommand}" Margin="8,0,0,0"
                                IsVisible="{Binding IsNxmRegistered}"/>
                        <TextBlock Text="{Binding NxmStatusText}"
                                   Foreground="{Binding NxmStatusColor}"
                                   VerticalAlignment="Center" Margin="12,0,0,0" FontSize="12"/>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Logs -->
            <Border Classes="card" Margin="0,0,0,12">
                <StackPanel>
                    <Grid Margin="0,0,0,8">
                        <TextBlock Text="LOGS" Classes="label" FontWeight="SemiBold"
                                   VerticalAlignment="Center"/>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Content="Refresh" Classes="secondary" Padding="10,4" FontSize="11"
                                    Command="{Binding RefreshLogsCommand}" Margin="0,0,6,0"/>
                            <Button Content="Copy" Classes="secondary" Padding="10,4" FontSize="11"
                                    Command="{Binding CopyLogsCommand}" Margin="0,0,6,0"/>
                            <Button Content="Save as .txt" Classes="secondary" Padding="10,4" FontSize="11"
                                    Command="{Binding SaveLogsCommand}" Margin="0,0,6,0"/>
                            <Button Content="Clear" Classes="secondary" Padding="10,4" FontSize="11"
                                    Command="{Binding ClearLogsCommand}"/>
                        </StackPanel>
                    </Grid>
                    <Border Background="{StaticResource BgDarkBrush}" CornerRadius="4"
                            Padding="10,8" MaxHeight="300">
                        <ScrollViewer VerticalScrollBarVisibility="Auto"
                                      HorizontalScrollBarVisibility="Auto">
                            <TextBlock Text="{Binding LogText}" FontFamily="Consolas,Courier New,monospace"
                                       FontSize="11" Foreground="{StaticResource TextSecondaryBrush}"
                                       TextWrapping="NoWrap"/>
                        </ScrollViewer>
                    </Border>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</UserControl>
